<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Support Smart Solar Panels for Saudi Homes on YallaStarter. Revolutionary solar technology designed for Saudi Arabia's climate.">
    <meta name="keywords" content="solar panels, renewable energy, Saudi Arabia, crowdfunding, green technology">
    <meta name="author" content="YallaStarter">
    <meta name="robots" content="index, follow">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Smart Solar Panels for Saudi Homes - YallaStarter">
    <meta property="og:description"
        content="Support Smart Solar Panels for Saudi Homes on YallaStarter. Revolutionary solar technology designed for Saudi Arabia's climate.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yallastarter.com/project/smart-solar-panels">

    <!-- Preload Critical Resources -->
    <link rel="preload" href="styles.css" as="style">
    <link rel="preload"
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Tajawal:wght@300;400;500;700&display=swap"
        as="style">

    <title>تفاصيل المشروع - يلا ستارتر</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="mobile-menu.css">
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Tajawal:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Tajawal', sans-serif; text-align: right; direction: rtl; }
        .dashboard-sidebar { border-right: none; border-left: 1px solid var(--neutral-200); }
        .sidebar-menu-icon { margin-right: 0; margin-left: 1rem; }
        .sidebar-menu-link.active { border-right: none; border-left: 3px solid var(--primary); }
        .nav-links { margin-left: auto; margin-right: 0; }
        .logo { margin-left: 1rem; margin-right: 0; }
        .user-avatar { margin-right: 0; margin-left: 1rem; }
        /* Fix dropdown for RTL */
        .user-dropdown-menu { right: auto; left: 0; text-align: right; transform-origin: top left; }
        .dropdown-item { display: flex !important; align-items: center; gap: 10px; flex-direction: row; }
        .dropdown-item i { margin-left: 0; margin-right: 0; }
        /* Fix spinner for RTL */
        .fa-spin { display: inline-block; }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="index-ar.html" class="logo">
                    <span class="logo-text">YallaStarter</span>
                </a>

                <button class="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>

                <ul class="nav-links">
                    <li><a href="index-ar.html">الرئيسية</a></li>
                    <li><a href="projects.html" class="active">تصفح المشاريع</a></li>
                    <li><a href="how-it-works.html">كيف يعمل</a></li>
                    <li><a href="about.html">من نحن</a></li>
                    <li><a href="contact.html">اتصل بنا</a></li>
                </ul>

                <div class="auth-buttons">
                    <a href="login.html" class="btn btn-link">تسجيل الدخول</a>
                    <a href="signup.html" class="btn btn-primary">حساب جديد</a>
                </div>

                <div class="mobile-menu">
                    <div class="mobile-menu-header">

                        <button class="mobile-close-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <ul class="nav-links">
                        <li><a href="index-ar.html">الرئيسية</a></li>
                        <li><a href="entertainment.html">Entertainment Projects</a></li>
                        <li><a href="vision2030.html">Vision 2030 Projects</a></li>
                        <li><a href="mind71.html">MIND71 AI</a></li>
                        <li><a href="projects.html" class="active">تصفح المشاريع</a></li>
                        <li><a href="how-it-works.html">كيف يعمل</a></li>
                        <li><a href="about.html">من نحن</a></li>
                        <li><a href="contact.html">اتصل بنا</a></li>
                    </ul>
                    <div class="language-switcher">
                        <button class="language-btn active" onclick="switchLanguage('en')">English</button>
                        <button class="language-btn" onclick="switchLanguage('ar')">العربية</button>
                    </div>
                    <div class="auth-buttons">
                        <a href="create-project-ar.html" class="btn btn-primary">Start a Project</a>
                        <a href="login.html" class="btn btn-link">تسجيل الدخول</a>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Project Details -->
    <section class="project-details">
        <div class="container">
            <!-- Breadcrumb -->
            <div style="margin-bottom: 2rem;">
                <a href="projects.html"
                    style="display: flex; align-items: center; gap: 0.5rem; color: var(--neutral-600); font-size: 0.9rem;">
                    <i class="fas fa-arrow-left"></i> Back to Projects
                </a>
            </div>

            <div class="project-header">
                <div class="project-gallery" id="projectGallery">
                    <img id="projectCoverImg"
                        src="https://images.unsplash.com/photo-1497435334941-8c899ee9e8e9?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80"
                        alt="Project">
                </div>
                <div id="projectVideoWrap" style="display: none; margin-top: 1rem;"></div>

                <div class="project-info">
                    <div class="project-info-header">
                        <div class="project-info-category">Technology</div>
                        <h1 class="project-info-title">Smart Solar Panels for Saudi Homes</h1>
                        <p class="project-info-description">Revolutionary solar technology designed specifically for
                            Saudi Arabia's climate, helping reduce energy costs by up to 40%.</p>
                    </div>

                    <div class="project-creator" style="margin-bottom: 1.5rem;">
                        <div class="creator-avatar">
                            <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Creator">
                        </div>
                        <div style="display: flex; flex-direction: column;">
                            <div class="creator-name" style="font-weight: 500;">Ahmed Al-Faris</div>
                            <div style="font-size: 0.9rem; color: var(--neutral-600);">Riyadh, Saudi Arabia</div>
                        </div>
                    </div>

                    <div class="project-funding">
                        <div class="funding-stats">
                            <div class="funding-amount">ريال 320,500</div>
                            <div class="funding-goal">of ريال 500,000 goal</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 64%;"></div>
                        </div>
                    </div>

                    <div class="project-meta-stats">
                        <div class="meta-item">
                            <i class="fas fa-user meta-icon"></i>
                            <span>428 backers</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-clock meta-icon"></i>
                            <span>18 يوم متبقي</span>
                        </div>
                    </div>

                    <div class="project-actions">
                        <a href="#" id="backProjectBtn" class="btn btn-primary"
                            style="width: 100%; padding: 1rem; font-size: 1.1rem; text-align: center; text-decoration: none; display: block;">Back
                            this project</a>

                        <div style="display: flex; justify-content: space-between; margin-top: 1rem;">
                            <button id="likeBtn" class="btn btn-outline"
                                style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-heart"></i> Like
                            </button>
                            <button id="shareBtn" class="btn btn-outline"
                                style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-share-alt"></i> Share
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-top: 3rem;">
                <div class="project-tabs">
                    <div class="tabs-nav">
                        <div class="tab-item active">Story</div>
                        <div class="tab-item">Updates</div>
                        <div class="tab-item">FAQ</div>
                        <div class="tab-item">Comments</div>
                    </div>

                    <div class="tab-content active">
                        <div class="project-story">
                            <h2>About This Project</h2>
                            <p>Our Smart Solar Panels are specifically designed for the unique climate conditions of
                                Saudi Arabia. Traditional solar panels lose efficiency in extreme heat, but our
                                innovative technology actually thrives in the Saudi climate, maintaining peak
                                performance even during the hottest summer days.</p>

                            <img src="https://images.unsplash.com/photo-1594818379496-da1e345b0ded?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80"
                                alt="Solar Panel Installation">

                            <h3>The Problem</h3>
                            <p>Saudi Arabia has one of the highest solar irradiation rates in the world, making it ideal
                                for solar energy production. However, conventional solar panels suffer from efficiency
                                losses of up to 25% during peak summer temperatures, precisely when energy demand is
                                highest for cooling.</p>

                            <h3>Our Solution</h3>
                            <p>We've developed a proprietary cooling system and high-temperature resistant materials
                                that allow our panels to maintain optimal efficiency even at temperatures exceeding
                                50°C. This results in up to 40% more energy production compared to conventional panels
                                in the Saudi climate.</p>

                            <h3>Key Features</h3>
                            <ul>
                                <li>Heat-resistant photovoltaic cells that maintain efficiency at high temperatures</li>
                                <li>Passive cooling system requiring no additional energy input</li>
                                <li>Smart monitoring system with mobile app integration</li>
                                <li>Sand and dust resistant coating for minimal maintenance</li>
                                <li>25-year performance warranty</li>
                            </ul>

                            <h3>Vision 2030 Alignment</h3>
                            <p>Our project directly supports Saudi Vision 2030's renewable energy goals by contributing
                                to the kingdom's target of generating 50% of its electricity from renewables by 2030. By
                                making solar energy more efficient and accessible, we're helping reduce carbon emissions
                                while creating jobs in the growing renewable energy sector.</p>

                            <h3>Timeline</h3>
                            <div style="margin: 2rem 0; padding-left: 2rem; border-left: 2px solid var(--primary);">
                                <div style="position: relative; margin-bottom: 2rem;">
                                    <div
                                        style="position: absolute; left: -2.5rem; width: 2rem; height: 2rem; background-color: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                                        1</div>
                                    <h4 style="margin-bottom: 0.5rem; color: var(--neutral-900);">Q2 2025: Finalize
                                        Production</h4>
                                    <p style="color: var(--neutral-700);">Complete manufacturing setup and quality
                                        testing</p>
                                </div>

                                <div style="position: relative; margin-bottom: 2rem;">
                                    <div
                                        style="position: absolute; left: -2.5rem; width: 2rem; height: 2rem; background-color: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                                        2</div>
                                    <h4 style="margin-bottom: 0.5rem; color: var(--neutral-900);">Q3 2025: Initial
                                        Deployment</h4>
                                    <p style="color: var(--neutral-700);">First batch of panels installed for backers
                                    </p>
                                </div>

                                <div style="position: relative;">
                                    <div
                                        style="position: absolute; left: -2.5rem; width: 2rem; height: 2rem; background-color: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                                        3</div>
                                    <h4 style="margin-bottom: 0.5rem; color: var(--neutral-900);">Q4 2025: Full Market
                                        Launch</h4>
                                    <p style="color: var(--neutral-700);">Nationwide availability and expansion plans
                                    </p>
                                </div>
                            </div>

                            <h3>Meet the Team</h3>
                            <p>Our team consists of experienced engineers, renewable energy experts, and business
                                professionals with a shared passion for sustainable energy solutions in Saudi Arabia.
                            </p>

                            <div style="display: flex; gap: 2rem; margin: 2rem 0;">
                                <div style="text-align: center;">
                                    <div
                                        style="width: 120px; height: 120px; border-radius: 50%; overflow: hidden; margin: 0 auto 1rem;">
                                        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Ahmed Al-Faris"
                                            style="width: 100%; height: 100%; object-fit: cover;">
                                    </div>
                                    <h4 style="margin-bottom: 0.5rem; color: var(--neutral-900);">Ahmed Al-Faris</h4>
                                    <p style="color: var(--primary); margin-bottom: 0.5rem;">Founder & CEO</p>
                                    <p style="color: var(--neutral-700); font-size: 0.9rem;">Renewable energy engineer
                                        with 10+ years of experience</p>
                                </div>

                                <div style="text-align: center;">
                                    <div
                                        style="width: 120px; height: 120px; border-radius: 50%; overflow: hidden; margin: 0 auto 1rem;">
                                        <img src="https://randomuser.me/api/portraits/women/44.jpg"
                                            alt="Fatima Al-Zahrani"
                                            style="width: 100%; height: 100%; object-fit: cover;">
                                    </div>
                                    <h4 style="margin-bottom: 0.5rem; color: var(--neutral-900);">Fatima Al-Zahrani</h4>
                                    <p style="color: var(--primary); margin-bottom: 0.5rem;">CTO</p>
                                    <p style="color: var(--neutral-700); font-size: 0.9rem;">Materials scientist
                                        specializing in photovoltaic technology</p>
                                </div>

                                <div style="text-align: center;">
                                    <div
                                        style="width: 120px; height: 120px; border-radius: 50%; overflow: hidden; margin: 0 auto 1rem;">
                                        <img src="https://randomuser.me/api/portraits/men/22.jpg" alt="Khalid Al-Otaibi"
                                            style="width: 100%; height: 100%; object-fit: cover;">
                                    </div>
                                    <h4 style="margin-bottom: 0.5rem; color: var(--neutral-900);">Khalid Al-Otaibi</h4>
                                    <p style="color: var(--primary); margin-bottom: 0.5rem;">COO</p>
                                    <p style="color: var(--neutral-700); font-size: 0.9rem;">Operations expert with
                                        background in manufacturing</p>
                                </div>
                            </div>

                            <h3>Risks & Challenges</h3>
                            <p>While we've conducted extensive testing and have a clear production plan, any
                                manufacturing project can face challenges. Potential risks include:</p>
                            <ul>
                                <li>Supply chain delays affecting component availability</li>
                                <li>Regulatory approvals taking longer than anticipated</li>
                                <li>Scaling production to meet demand</li>
                            </ul>
                            <p>We've built contingency plans into our timeline and have established relationships with
                                multiple suppliers to mitigate these risks. We're committed to transparent communication
                                with our backers throughout the process.</p>
                        </div>
                    </div>
                </div>

                <div class="rewards-section">
                    <h3 class="rewards-title">Support This Project</h3>
                    <div id="rewardsContainer">
                        <p style="color: var(--neutral-500); font-style: italic;">Loading rewards...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>YallaStarter</h3>
                    <ul class="footer-links">
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="how-it-works.html">كيف يعمل</a></li>
                        <li><a href="projects.html">تصفح المشاريع</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                        <li><a href="careers.html">Careers</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h3>For Creators</h3>
                    <ul class="footer-links">
                        <li><a href="create-project-ar.html">Start a Project</a></li>
                        <li><a href="creator-handbook.html">Creator Handbook</a></li>
                        <li><a href="creator-resources.html">Creator Resources</a></li>
                        <li><a href="creator-faqs.html">Creator FAQs</a></li>
                        <li><a href="success-stories.html">Success Stories</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h3>For Backers</h3>
                    <ul class="footer-links">
                        <li><a href="backer-faqs.html">Backer FAQs</a></li>
                        <li><a href="trust-safety.html">Trust & Safety</a></li>
                        <li><a href="backer-resources.html">Backer Resources</a></li>
                        <li><a href="payment-methods.html">Payment Methods</a></li>
                        <li><a href="backer-protection.html">Backer Protection</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h3>Connect With Us</h3>
                    <ul class="footer-links">
                        <li><a href="newsletter.html">Newsletter</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="events.html">Events</a></li>
                        <li><a href="support-ar.html">Support</a></li>
                        <li><a href="admin-login.html" class="employee-access-link"><i class="fas fa-user-shield"
                                    style="margin-right: 5px; opacity: 0.7;"></i>Employee Access</a></li>
                        <li><a href="community-guidelines.html">Community Guidelines</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <div class="footer-copyright">
                    &copy; 2025 YallaStarter. All rights reserved.
                </div>

                <div class="footer-social">
                    <a href="contact.html" class="social-icon" aria-label="Contact"><i
                            class="fab fa-facebook-f"></i></a>
                    <a href="contact.html" class="social-icon" aria-label="Contact"><i class="fab fa-twitter"></i></a>
                    <a href="contact.html" class="social-icon" aria-label="Contact"><i class="fab fa-instagram"></i></a>
                    <a href="contact.html" class="social-icon" aria-label="Contact"><i
                            class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Mobile Menu Toggle
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const mobileMenu = document.querySelector('.mobile-menu');

        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.style.display = mobileMenu.style.display === 'none' ? 'block' : 'none';
        });

        // Tabs
        const tabItems = document.querySelectorAll('.tab-item');
        const tabContents = document.querySelectorAll('.tab-content');

        tabItems.forEach((tab, index) => {
            tab.addEventListener('click', () => {
                tabItems.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));

                tab.classList.add('active');
                tabContents[index]?.classList.add('active');
            });
        });
    </script>

    <!-- Universal Mobile Menu Script -->
    <script src="mobile-menu.js"></script>

    <!-- Dynamic Project Loader -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const projectId = urlParams.get('id');

            if (projectId) {
                try {
                    const res = await fetch(`/api/projects/${projectId}`);
                    const data = await res.json();

                    if (data.success && data.data) {
                        const project = data.data;
                        const percent = Math.min(100, Math.round((project.currentAmount / project.goalAmount) * 100));

                        // Update Page Title
                        document.title = `${project.title} - YallaStarter`;

                        // Update Meta Description
                        const metaDesc = document.querySelector('meta[name="description"]');
                        if (metaDesc) metaDesc.content = project.description.substring(0, 160);

                        // Update Content
                        document.querySelector('.project-info-title').textContent = project.title;
                        document.querySelector('.project-info-description').textContent = project.description;
                        document.querySelector('.project-info-category').textContent = project.category || 'General';

                        document.querySelector('.funding-amount').textContent = `ريال ${project.currentAmount}`;
                        document.querySelector('.funding-goal').textContent = `of ريال ${project.goalAmount} goal`;
                        document.querySelector('.progress-fill').style.width = `${percent}%`;

                        // Creator (Mock if not fully populated)
                        if (project.creator) {
                            // Check if creator is populated object or just ID
                            const creatorName = project.creator.username || 'Project Creator';
                            document.querySelector('.creator-name').textContent = creatorName;
                        }

                        // Cover image
                        const projectImg = document.getElementById('projectCoverImg');
                        if (projectImg) {
                            if (project.coverImage) {
                                projectImg.src = project.coverImage;
                            }
                            projectImg.alt = project.title;
                        }
                        // Gallery (append extra images below cover if any)
                        const galleryEl = document.getElementById('projectGallery');
                        if (galleryEl && project.gallery && project.gallery.length > 0) {
                            project.gallery.forEach(url => {
                                const img = document.createElement('img');
                                img.src = url;
                                img.alt = project.title;
                                img.style.width = '100%';
                                img.style.marginTop = '0.5rem';
                                img.style.borderRadius = '8px';
                                galleryEl.appendChild(img);
                            });
                        }
                        // Video embed
                        const videoWrap = document.getElementById('projectVideoWrap');
                        if (videoWrap && project.videoUrl) {
                            let embedUrl = '';
                            if (project.videoUrl.includes('youtube.com') || project.videoUrl.includes('youtu.be')) {
                                const m = project.videoUrl.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&?]+)/);
                                embedUrl = m ? 'https://www.youtube.com/embed/' + m[1] : '';
                            } else if (project.videoUrl.includes('vimeo.com')) {
                                const m = project.videoUrl.match(/vimeo\.com\/(\d+)/);
                                embedUrl = m ? 'https://player.vimeo.com/video/' + m[1] : '';
                            }
                            if (embedUrl) {
                                videoWrap.innerHTML = '<iframe width="100%" height="400" src="' + embedUrl + '" frameborder="0" allowfullscreen></iframe>';
                                videoWrap.style.display = 'block';
                            }
                        }
                        // Back this project link
                        const backBtn = document.getElementById('backProjectBtn');
                        if (backBtn) {
                            backBtn.href = 'coins.html?projectId=' + encodeURIComponent(projectId);
                        }

                        // Favorite / Like Integration
                        const likeBtn = document.getElementById('likeBtn');
                        let isFavorited = false;

                        const updateLikeUI = (fav) => {
                            isFavorited = fav;
                            if (likeBtn) {
                                const heartIcon = likeBtn.querySelector('i');
                                if (fav) {
                                    likeBtn.classList.add('active');
                                    likeBtn.style.backgroundColor = 'var(--primary)';
                                    likeBtn.style.color = 'white';
                                    if (heartIcon) heartIcon.style.color = 'white';
                                } else {
                                    likeBtn.classList.remove('active');
                                    likeBtn.style.backgroundColor = 'transparent';
                                    likeBtn.style.color = 'var(--primary)';
                                    if (heartIcon) heartIcon.style.color = 'var(--primary)';
                                }
                            }
                        };

                        // Check initial favorite status
                        const token = (window.auth && typeof window.auth.getToken === 'function') ? window.auth.getToken() : localStorage.getItem('token');
                        if (token) {
                            try {
                                const favRes = await fetch(`/api/projects/${projectId}/favorite`, {
                                    headers: { 'Authorization': 'Bearer ' + token }
                                });
                                const favData = await favRes.json();
                                if (favData.success) updateLikeUI(favData.favorited);
                            } catch (err) { console.error('Error checking favorite:', err); }
                        }

                        if (likeBtn) {
                            likeBtn.addEventListener('click', async () => {
                                if (!token) {
                                    alert('Please log in to like a project!');
                                    window.location.href = 'login.html';
                                    return;
                                }

                                try {
                                    likeBtn.disabled = true;
                                    const res = await fetch(`/api/projects/${projectId}/favorite`, {
                                        method: 'POST',
                                        headers: { 'Authorization': 'Bearer ' + token }
                                    });
                                    const data = await res.json();
                                    if (data.success) updateLikeUI(data.favorited);
                                    else alert(data.message || 'Failed to toggle favorite.');
                                } catch (err) {
                                    console.error('Favorite toggle error:', err);
                                } finally {
                                    likeBtn.disabled = false;
                                }
                            });
                        }

                        // Share Integration
                        const shareBtn = document.getElementById('shareBtn');
                        if (shareBtn) {
                            shareBtn.addEventListener('click', async () => {
                                const shareData = {
                                    title: document.title,
                                    text: `Check out this project on YallaStarter: ${project.title}`,
                                    url: window.location.href
                                };

                                try {
                                    if (navigator.share) {
                                        await navigator.share(shareData);
                                    } else {
                                        await navigator.clipboard.writeText(window.location.href);
                                        alert('Link copied to clipboard!');
                                    }
                                } catch (err) {
                                    console.error('Share error:', err);
                                }
                            });
                        }

                        // Story (using description + story)
                        const storyHtml = project.story
                            ? `<h2>About This Project</h2><p>${project.description}</p><div>${project.story.replace(/\n/g, '<br>')}</div>`
                            : `<h2>About This Project</h2><p>${project.description}</p><h3>Category</h3><p>${project.category}</p><h3>Funding Status</h3><p>This project has تم جمعها ريال ${project.currentAmount} of its ريال ${project.goalAmount} goal (${percent}%).</p>`;
                        const storyEl = document.querySelector('.project-story');
                        if (storyEl) storyEl.innerHTML = storyHtml;
                        // Rewards
                        const rewardsContainer = document.getElementById('rewardsContainer');
                        if (rewardsContainer) {
                            rewardsContainer.innerHTML = '';
                            if (project.rewards && Array.isArray(project.rewards) && project.rewards.length > 0) {
                                project.rewards.forEach(reward => {
                                    let includesHtml = '';
                                    if (reward.includes && Array.isArray(reward.includes) && reward.includes.length > 0) {
                                        const liHtml = reward.includes.map(item => `<li>${item}</li>`).join('');
                                        includesHtml = `
                                            <div class="reward-includes">
                                                <h5>Includes:</h5>
                                                <ul class="includes-list">${liHtml}</ul>
                                            </div>
                                        `;
                                    }
                                    let deliveryHtml = '';
                                    if (reward.deliveryDate) {
                                        const dateLabel = new Date(reward.deliveryDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
                                        if (dateLabel !== 'Invalid Date') {
                                            deliveryHtml = `<div class="reward-delivery">Estimated delivery: ${dateLabel}</div>`;
                                        }
                                    }
                                    const card = document.createElement('div');
                                    card.className = 'reward-card';
                                    card.innerHTML = `
                                        <div class="reward-header">
                                            <h4 class="reward-name">${reward.title}</h4>
                                            <div class="reward-amount">ريال ${reward.amount.toLocaleString()}</div>
                                        </div>
                                        <p class="reward-description">${reward.description}</p>
                                        ${includesHtml}
                                        ${deliveryHtml}
                                        <button class="btn btn-primary" style="width: 100%;" onclick="window.location.href='checkout.html?projectId=${project._id}&amount=${reward.amount}'">Select this reward</button>
                                    `;
                                    rewardsContainer.appendChild(card);
                                });
                            } else {
                                rewardsContainer.innerHTML = `
                                    <div class="reward-card">
                                        <div class="reward-header">
                                            <h4 class="reward-name">Support the Project</h4>
                                            <div class="reward-amount">Any Amount</div>
                                        </div>
                                        <p class="reward-description">Back this project with a custom amount to help bring it to life.</p>
                                        <button class="btn btn-primary" style="width: 100%;" onclick="window.location.href='coins.html?projectId=${project._id}'">Pledge Without Reward</button>
                                    </div>
                                `;
                            }
                        }
                    }
                } catch (err) {
                    console.error('Error loading project details:', err);
                }
            }

            // "Back this project" is a link to coins.html?projectId=... (set above when project loads)
        });
    </script>
</body>

</html>